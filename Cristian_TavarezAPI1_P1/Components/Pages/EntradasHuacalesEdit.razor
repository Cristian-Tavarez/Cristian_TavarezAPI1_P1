@page "/entradashuacales/edit/{Id:int}"
@rendermode InteractiveServer
@using Cristian_TavarezAPI1_P1.Models
@using Cristian_TavarezAPI1_P1.Services
@inject EntradasHuacalesService service
@inject NavigationManager nav

<div class="row justify-content-center mt-4">
    <div class="col-md-6">
        <div class="card shadow-sm">
            <div class="card-header text-center">
                <h4>Modificar Entrada de Huacales</h4>
            </div>

            <div class="card-body">
                @if (entrada == null)
                {
                    <p class="text-danger text-center">
                        Registro no encontrado
                    </p>
                }
                else
                {
                    <EditForm Model="entrada"
                              OnValidSubmit="Guardar"
                              FormName="editarEntradaHuacales">
                        <DataAnnotationsValidator />
                        <ValidationSummary class="text-danger" />

                        <div class="mb-3">
                            <label class="form-label fw-bold">Fecha</label>
                            <InputDate class="form-control"
                                       @bind-Value="entrada.Fecha" />
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Cliente</label>
                            <InputText class="form-control"
                                       @bind-Value="entrada.NombreCliente" />
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Cantidad</label>
                            <InputNumber class="form-control"
                                         @bind-Value="entrada.Cantidad" />
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Precio</label>
                            <InputNumber class="form-control"
                                         @bind-Value="entrada.Precio" />
                        </div>

                        <div class="d-flex justify-content-between mt-4">
                            <button type="button"
                                    class="btn btn-secondary"
                                    @onclick="Volver">
                                ← Volver
                            </button>

                            <div>
                                <button type="submit"
                                        class="btn btn-primary me-2">
                                    💾 Modificar
                                </button>

                                <button type="button"
                                        class="btn btn-danger"
                                        @onclick="Eliminar">
                                    🗑 Eliminar
                                </button>
                            </div>
                        </div>
                    </EditForm>
                }
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter]
    public int Id { get; set; }

    private EntradaHuacales? entrada;

    protected override async Task OnInitializedAsync()
    {
        entrada = await service.BuscarAsync(Id);
    }

    private async Task Guardar()
    {
        await service.GuardarAsync(entrada!);
        nav.NavigateTo("/entradashuacales");
    }

    private async Task Eliminar()
    {
        await service.EliminarAsync(Id);
        nav.NavigateTo("/entradashuacales");
    }

    private void Volver()
    {
        nav.NavigateTo("/entradashuacales");
    }
}
